<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>激光SLAM Gmapping</title>
      <link href="/2024/09/20/%E6%BF%80%E5%85%89SLAM%20GMapping/"/>
      <url>/2024/09/20/%E6%BF%80%E5%85%89SLAM%20GMapping/</url>
      
        <content type="html"><![CDATA[<h1 id="激光SLAM-Gmapping"><a href="#激光SLAM-Gmapping" class="headerlink" title="激光SLAM Gmapping"></a>激光SLAM Gmapping</h1><h2 id="Gmapping原理分析"><a href="#Gmapping原理分析" class="headerlink" title="Gmapping原理分析"></a>Gmapping原理分析</h2><p>​        首先回顾一下SLAM问题的表示：</p><ul><li>贝叶斯网络表示（条件概率） ，求解：卡尔曼滤波、粒子滤波</li><li>因子图表示（最小二乘），求解：梯度下降法、高斯牛顿法</li><li>机器学习表示（神经网课），求解：神经网络训练</li></ul><p>​        而Gmapping是一种基于粒子滤波的算法。不过在Gmapping算法中，对 RBPF（Rao-BlackwellizationParticleFilte）的建议分布和重采样进行了改进。</p><h3 id="RBPF-的滤波过程"><a href="#RBPF-的滤波过程" class="headerlink" title="RBPF 的滤波过程"></a>RBPF 的滤波过程</h3><p>​        RBPF 的思想就是将 SLAM 中的定位和建图问题分开来处理，先利用$P(x_{1:t} \mid z_{1:t},u_{1:t-1} )$估计出机器人的轨迹$x_{1:t}$，然后在轨迹已知的情况下很容易估计出地图 <strong><em>m</em></strong>。公式如下：</p><script type="math/tex; mode=display">P\left(x_{1:t},m \mid z_{1:t}, u_{1:t} \right)=P\left( m \mid x_{1:t},z_{1:t} \right) \cdot P\left( x_{1:t} \mid z_{1:t},u_{1:t-1}\right)</script><p>​        在给定机器人位资的情况下，利用$P( m \mid x_{1:t},z_{1:t} )$ 建图很简单。RBPF 讨论的重点是$P( x_{1:t} \mid z_{1:t},u_{1:t-1})$ 定位问题的具体求解过程，一种流行的粒子滤波算法是 SIR（sampling importance resampling）滤波器。下面介绍基于 SIR 的RBPF 滤波过程。</p><h4 id="采样"><a href="#采样" class="headerlink" title="采样"></a>采样</h4><p>​        新的粒子点集 ${x_{1:t}^{(i)} }$ 由上一个时刻粒子点集${x_{1:t-1}^{(i)} }$ 在建议分布 $\pi$ 里采样得到。通常把机器人概率运动模型作为建议分布，这样新的粒子点集  ${x_{t}^{(i)} }$ 的生成过程就可以表示成 $x_{t}^{(i)} \sim P ( x_{1:t} \mid x_{t-1}^{(i)},u_{t-1})$。</p><h4 id="重要性权重"><a href="#重要性权重" class="headerlink" title="重要性权重"></a>重要性权重</h4><p>​        考虑整个运动过程，机器人每条可能得轨迹都可以用一个粒子点$x_{1:t}^{(i)}$ 表示，那么每条轨迹对应粒子点的重要性权重可以表示为</p><script type="math/tex; mode=display">w_{i}^{(i)} = \frac{ P\left( x_{1:t}^{(i)} \mid z_{1:t},u_{1:t-1} \right)}{ \pi\left( x_{1:t}^{(i)} \mid z_{1:t},u_{1:t-1} \right)}</script><p>​        其中分子是目标分布，分母是建议分布，重要性权重反应了建议分布和目标分布的差异性。</p><h4 id="重采样"><a href="#重采样" class="headerlink" title="重采样"></a>重采样</h4><p>​        新生成的粒子点需要利用重要性权重进行替换，这就是重采样。由于粒子点总量保持不变，当权重比较小的粒子点被删除后，权重大的粒子点需要进行复制以保持粒子总量不变。经过重采样后粒子点的权重都变成一样，接着进行下一轮采样和重采样。</p><h4 id="地图估计"><a href="#地图估计" class="headerlink" title="地图估计"></a>地图估计</h4><p>​        在每条轨迹对用粒子点$x_{1:t}^{(i)}$ 的条件下，都可以用$P( m^{(i)} \mid x_{1:t}^{(i)},z_{1:t} )$ 计算出一幅地图$m^{(i)}$，然后将每个轨迹计算出的地图整合就得到最终地图 $m$。</p><p>​        从重要性权重的公式中会发现一个明显的问题，不管当前获取的观测$z_i$ 是否有效，都要计算一次整个轨迹的权重，而且随着时间的推移，轨迹将变得很长，计算整个轨迹的权重的计算量会越来越大。将原来的重要性权重公式进行适当推导，得到权重的递归计算方法：</p><script type="math/tex; mode=display">\begin{align*}w_t^{(i)} &= \frac{P(x_{1:t}^{(i)} \mid z_{1:t}, u_{1:t-1})}{\pi(x_{1:t}^{(i)} \mid z_{1:t}, u_{1:t-1})} \\&= \frac{P(z_t \mid x_{1:t}^{(i)}, z_{1:t-1}) P(x_{1:t}^{(i)} \mid z_{1:t-1}, u_{1:t-1}) / P(z_t \mid z_{1:t-1}, u_{1:t-1})}{\pi(x_{1:t}^{(i)} \mid x_{1:t-1}^{(i)}, z_{1:t}, u_{1:t-1}) \pi(x_{1:t-1}^{(i)} \mid z_{1:t-1}, u_{1:t-2})} \\&= \frac{P(z_t \mid x_{1:t}^{(i)}, z_{1:t-1}) P(x_t^{(i)} \mid x_{1:t-1}^{(i)}, u_{1:t-1}) P(x_{1:t-1}^{(i)} \mid z_{1:t-1}, u_{1:t-2}) \eta}{\pi(x_t^{(i)} \mid x_{1:t-1}^{(i)}, z_{1:t}, u_{1:t-1}) \pi(x_{1:t-1}^{(i)} \mid z_{1:t-1}, u_{1:t-2})} \\&\propto \frac{P(z_t \mid m_{t-1}^{(i)}, x_t^{(i)}) P(x_t^{(i)} \mid x_{t-1}^{(i)}, u_{t-1})}{\pi(x_t^{(i)} \mid x_{1:t-1}^{(i)}, z_{1:t}, u_{1:t-1})} \cdot w_{t-1}^{(i)}\end{align*}</script><p>​        其中，$η=1/P(z_t∣z_{1:t−1},u_{1:t−1})$。</p><h3 id="RBPF-的建议分布改进"><a href="#RBPF-的建议分布改进" class="headerlink" title="RBPF 的建议分布改进"></a>RBPF 的建议分布改进</h3>]]></content>
      
      
      <categories>
          
          <category> SLAM 学习 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>基于因子图的状态估计</title>
      <link href="/2024/09/08/%E5%9F%BA%E4%BA%8E%E5%9B%A0%E5%AD%90%E5%9B%BE%E7%9A%84%E7%8A%B6%E6%80%81%E4%BC%B0%E8%AE%A1/"/>
      <url>/2024/09/08/%E5%9F%BA%E4%BA%8E%E5%9B%A0%E5%AD%90%E5%9B%BE%E7%9A%84%E7%8A%B6%E6%80%81%E4%BC%B0%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="基于因子图的状态估计"><a href="#基于因子图的状态估计" class="headerlink" title="基于因子图的状态估计"></a>基于因子图的状态估计</h1><blockquote><p>记录学习《机器人SLAM导航核心技术与实战》的一些知识，配套教学视频：<a href="https://www.bilibili.com/video/BV1jS4y1a7Lz/?spm_id_from=333.999.0.0">《机器人SLAM导航核心技术与实战》书籍配套教学视频</a></p></blockquote><p>​        虽然完全 SLAM 系统可以用滤波方法求解，比如著名的  Fast-SLAM  框架，但是贝叶斯网络表示下的完全 SLAM 系统能很方便地转换成因子图表示，这样贝叶斯网络中的最大后验估计就等效为因子图中的最小二乘估计。本节主要讨论的就是如何求解最小二乘问题（通常为非线性最小二乘问题）。</p><p>​        求解非线性最小二乘问题的方法大致有两种：</p><ul><li>先对非线性问题进行线性化近似处理，然后直接求解线性方程来得到待估计量</li><li>不直接求解，通过迭代策略，让目标函数快速下降到最值处，对应的估计量也就求出来了</li></ul><p><img src="/img/基于因子图的状态估计/image-20241111122640547.png" alt="image-20241111122640547"></p><h2 id="直接求解方法"><a href="#直接求解方法" class="headerlink" title="直接求解方法"></a>直接求解方法</h2><p>​        非线性最小二乘问题表示为：</p><p>​                                                                                            <img src="/img/基于因子图的状态估计/image-20241112164844980.png" alt="image-20241112164844980" style="zoom: 67%;" /></p><p>​        对 <strong><em>f(x)</em></strong>泰勒展开进行线性化近似，</p><p>​                            <img src="/img/基于因子图的状态估计/image-20241112165040661.png" alt="image-20241112165040661" style="zoom: 67%;" /></p><p>​                                                                    <img src="/img/基于因子图的状态估计/image-20241112165052384.png" alt="image-20241112165052384" style="zoom:67%;" /></p><p>​        最小二乘问题可以变为</p><p>​                                        <img src="/img/基于因子图的状态估计/image-20241112165202146.png" alt="image-20241112165202146" style="zoom:67%;" /></p><p>​        上式在理想情况下可以取到0，即</p><p>​                                                    <img src="/img/基于因子图的状态估计/image-20241112165257965.png" alt="image-20241112165257965" style="zoom:67%;" /></p><p>​        对上面线性方程求解即可。求解上面线性方程有两种方法：Cholesky分解、QR分解。</p><ul><li>Cholesky分解</li></ul><p>​                                                        <img src="/img/基于因子图的状态估计/image-20241112165443865.png" alt="image-20241112165443865" style="zoom:67%;" /></p><ul><li>QR分解</li></ul><p>​                                                    <img src="/img/基于因子图的状态估计/image-20241112165500639.png" alt="image-20241112165500639" style="zoom:67%;" /></p><h2 id="优化方法"><a href="#优化方法" class="headerlink" title="优化方法"></a>优化方法</h2><p>​         由于实际 SLAM 问题的非线性最小二乘中，很难找到合适的线性化方法，初值也比较难确定，并且代价函数的误差往往不能最小化到0值，所以上面介绍的直接求解方法很难利用在实际问题中。实际工程中，通常采用优化方法进行迭代求解。</p><p>​         迭代策略主要有以下几种方法：</p><ul><li>梯度下降算法</li><li>最速下降算法</li><li>高斯-牛顿算法</li><li>列文伯格-马夸尔特算法</li><li>狗腿算法</li></ul><p>​        具体如下：</p><p>​        <img src="/img/基于因子图的状态估计/image-20241112165814701.png" alt="image-20241112165814701"></p><p>​        可以发现，每一种方法都是前一种的改进，下降速度越来越好，但是每一步迭代的计算代价越来越高。</p><p>​        因此，在实际应用中要结合实际问题合理选择。比如Dogleg算法虽然每步迭代下降效果是最好的，但是每步迭代付出的计算代价也最昂贵，站在整个迭代过程看，迭代效率并不一定比最普通的梯度下降法好。</p><h2 id="常用的优化工具"><a href="#常用的优化工具" class="headerlink" title="常用的优化工具"></a>常用的优化工具</h2><ul><li>图优化工具 g2o （轻量级）</li><li>非线性优化工具 Ceres-Solver （复杂但性能强）</li><li>增量优化工具 GTSAM （精度稍低但支持增量优化）</li></ul>]]></content>
      
      
      <categories>
          
          <category> SLAM 学习 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>基于贝叶斯网络的状态估计</title>
      <link href="/2024/09/06/%E5%9F%BA%E4%BA%8E%E8%B4%9D%E5%8F%B6%E6%96%AF%E7%BD%91%E7%BB%9C%E7%9A%84%E7%8A%B6%E6%80%81%E4%BC%B0%E8%AE%A1/"/>
      <url>/2024/09/06/%E5%9F%BA%E4%BA%8E%E8%B4%9D%E5%8F%B6%E6%96%AF%E7%BD%91%E7%BB%9C%E7%9A%84%E7%8A%B6%E6%80%81%E4%BC%B0%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="基于贝叶斯网络的状态估计"><a href="#基于贝叶斯网络的状态估计" class="headerlink" title="基于贝叶斯网络的状态估计"></a>基于贝叶斯网络的状态估计</h1><blockquote><p>记录学习《机器人SLAM导航核心技术与实战》的一些知识，配套教学视频：<a href="https://www.bilibili.com/video/BV1jS4y1a7Lz/?spm_id_from=333.999.0.0">《机器人SLAM导航核心技术与实战》书籍配套教学视频</a></p></blockquote><p>​        之前的相关表示和推理都是基于一般情况而言，不涉及机器人实际数据。本节引入机器人实际测量数据，并基于贝叶斯网络表示这些数据的关系。基于这种表示，状态估计很容易进行，一般采用贝叶斯估计。</p><p>​        根据选取估计量不同，又分为以下几种估计问题：</p><ul><li>仅对机器人当前位姿状态 <img src="/img/基于贝叶斯网络的状态估计/image-20241108163403164.png" alt="image-20241108163403164" style="zoom:50%;" /> 进行状态估计，就是定位问题，对应后验概率分布表述如下：</li></ul><p>​                                                                                        <img src="/img/基于贝叶斯网络的状态估计/image-20241108163513104.png" alt="image-20241108163513104" style="zoom: 67%;" /></p><ul><li>除了当前位姿状态 <img src="/img/基于贝叶斯网络的状态估计/image-20241108163403164.png" alt="image-20241108163403164" style="zoom:50%;" />， 同时对地图 <img src="/img/基于贝叶斯网络的状态估计/image-20241108163616400.png" alt="image-20241108163616400" style="zoom:67%;" />进行估计，就是在线 SLAM 问题，对应后验概率分布表述如下：</li></ul><p>​                                                                                        <img src="/img/基于贝叶斯网络的状态估计/image-20241108163721327.png" alt="image-20241108163721327" style="zoom:67%;" /></p><ul><li>对于所有历史位姿  <img src="/img/基于贝叶斯网络的状态估计/image-20241108163759887.png" alt="image-20241108163759887" style="zoom:67%;" /> 和地图 <img src="/img/基于贝叶斯网络的状态估计/image-20241108163616400.png" alt="image-20241108163616400" style="zoom:67%;" /> 同时估计，就是完全 SLAM 问题，对应后验概率分布表述如下：</li></ul><p>​                                                                                        <img src="/img/基于贝叶斯网络的状态估计/image-20241108163901098.png" alt="image-20241108163901098" style="zoom:67%;" /></p><p>​        前两种问题求解过程都是类似的，也就是滤波方法。第三种也可以使用滤波方法求解，如著名的 Fast-SLAM 实现框架，但贝叶斯网络表示的完全 SLAM 系统可以方便转换为因子图表示，因此用因子图表示 SLAM 问题，然后使用最小二乘估计进行求解更方便。本节主要内容为前两种问题滤波方法的分析。第三种问题求解会在下节展开。</p><p><img src="/img/基于贝叶斯网络的状态估计/image-20241108164430212.png" alt="image-20241108164430212"></p><h2 id="贝叶斯估计"><a href="#贝叶斯估计" class="headerlink" title="贝叶斯估计"></a>贝叶斯估计</h2><p>​        以贝叶斯网络（表示）、定位（待估问题）、贝叶斯估计（求解方法）这种情况为例来讨论。</p><p>​        这里使用  <img src="/img/基于贝叶斯网络的状态估计/image-20241108164739436-1731055661940-1.png" alt="image-20241108164739436" style="zoom:67%;" /> 表示<img src="/img/基于贝叶斯网络的状态估计/image-20241108165355705.png" alt="image-20241108165355705" style="zoom:67%;" />（这里由于地图 <img src="/img/基于贝叶斯网络的状态估计/image-20241108163616400.png" alt="image-20241108163616400" style="zoom:67%;" /> 是常量可以忽略，将第一种问题的表示进行了化简），常称为<strong>置信度</strong>。<img src="/img/基于贝叶斯网络的状态估计/image-20241108164916041.png" alt="image-20241108164916041" style="zoom: 67%;" /> 为观测数据，<img src="/img/基于贝叶斯网络的状态估计/image-20241108164945205.png" alt="image-20241108164945205" style="zoom:67%;" /> 为运动数据。下图为推导过程：</p><p><img src="/img/基于贝叶斯网络的状态估计/image-20241108165107516.png" alt="image-20241108165107516" style="zoom:80%;" /></p><p>​        由右边两个式子可以整理得到<strong>递归贝叶斯滤波</strong>：</p><p>​                                                        <img src="/img/基于贝叶斯网络的状态估计/image-20241108165258339.png" alt="image-20241108165258339" style="zoom:80%;" /></p><p>​        由于后验概率分布<img src="/img/基于贝叶斯网络的状态估计/image-20241108165355705.png" alt="image-20241108165355705" style="zoom:67%;" /> 没有具体形式，也就是所递归贝叶斯滤波是一种通用框架，给定不同形式的分布后，贝叶斯滤波也就对应不同形式的算法实现。下面是分类：</p><p>​                                        <img src="/img/基于贝叶斯网络的状态估计/image-20241108165730058.png" alt="image-20241108165730058" style="zoom:67%;" /></p><p>​                <img src="/img/基于贝叶斯网络的状态估计/image-20241108165757852.png" alt="image-20241108165757852" style="zoom:67%;" /></p><p>​        下面从最简单的线性高斯系统入手，基于矩参数表示高斯分布，引出卡尔曼滤波（KF），然后讨论非线性高斯系统，引出扩展卡尔曼滤波（EKF）和无迹卡尔曼滤波（UKF）。</p><h2 id="参数化实现"><a href="#参数化实现" class="headerlink" title="参数化实现"></a>参数化实现</h2><h3 id="卡尔曼滤波"><a href="#卡尔曼滤波" class="headerlink" title="卡尔曼滤波"></a>卡尔曼滤波</h3><h4 id="线性卡尔曼滤波（线性高斯系统）"><a href="#线性卡尔曼滤波（线性高斯系统）" class="headerlink" title="线性卡尔曼滤波（线性高斯系统）"></a>线性卡尔曼滤波（线性高斯系统）</h4><p>​        高斯分布可以用矩参数（均值和方差）进行表示，那多维高斯分布为</p><p>​                                                        <img src="/img/基于贝叶斯网络的状态估计/image-20241108170240461.png" alt="image-20241108170240461" style="zoom:80%;" /></p><p>​        假设机器人的运动方程为    </p><p>​                                                                                <img src="/img/基于贝叶斯网络的状态估计/image-20241108170349049.png" alt="image-20241108170349049" style="zoom:80%;" />            </p><p>​        观测方程为</p><p>​                                                                                    <img src="/img/基于贝叶斯网络的状态估计/image-20241108170519088.png" alt="image-20241108170519088" style="zoom:80%;" /></p><p>​        得到的概率运动模型为：</p><p>​                        <img src="/img/基于贝叶斯网络的状态估计/image-20241108170831155.png" alt="image-20241108170831155" style="zoom:80%;" /></p><p>​        概率观测模型为：</p><p>​                                                <img src="/img/基于贝叶斯网络的状态估计/image-20241108170900544.png" alt="image-20241108170900544" style="zoom:80%;" /></p><p>​        待估状态量置信度的高斯分布形式为：</p><p>​                                                    <img src="/img/基于贝叶斯网络的状态估计/image-20241108171055411.png" alt="image-20241108171055411" style="zoom:80%;" /></p><p>​        卡尔曼滤波其实就是利用下面五个核心公式，递归计算：    </p><p><img src="/img/基于贝叶斯网络的状态估计/image-20241108171732416.png" alt="image-20241108171732416"></p><h4 id="扩展卡尔曼滤波（非线性高斯系统）"><a href="#扩展卡尔曼滤波（非线性高斯系统）" class="headerlink" title="扩展卡尔曼滤波（非线性高斯系统）"></a>扩展卡尔曼滤波（非线性高斯系统）</h4><p>​        线性卡尔曼滤波假设了机器人运动方程和观测方程都是线性的，但实际上往往都是非线性的，也就是说高斯随机变量经过非线性函数变换后都将变成非高斯随机变量，因此计算过程需要先<strong>线性化近似处理</strong>。在扩展卡尔曼滤波（EKF）中，采用一阶泰勒展开对非线性函数方程进行线性化。</p><p>​        对运动方程  <img src="/img/基于贝叶斯网络的状态估计/image-20241108174439333.png" alt="image-20241108174439333" style="zoom: 80%;" /> 进行一阶泰勒展开得到：</p><p>​                                                <img src="/img/基于贝叶斯网络的状态估计/image-20241108174508667.png" alt="image-20241108174508667" style="zoom:80%;" /></p><p>​        对观测方程 <img src="/img/基于贝叶斯网络的状态估计/image-20241108174523144.png" alt="image-20241108174523144" style="zoom:80%;" /> 展开得到：</p><p>​                                                            <img src="/img/基于贝叶斯网络的状态估计/image-20241108174547439.png" alt="image-20241108174547439" style="zoom:80%;" /></p><p>​        进而得到概率运动模型：</p><p>​                                    <img src="/img/基于贝叶斯网络的状态估计/image-20241108174610874.png" alt="image-20241108174610874" style="zoom:80%;" /></p><p>​        概率观测模型：</p><p>​                                            <img src="/img/基于贝叶斯网络的状态估计/image-20241108174627650.png" alt="image-20241108174627650" style="zoom:80%;" /></p><p>​        那卡尔曼滤波的五个核心公式变为：</p><p>​                                                                        <img src="/img/基于贝叶斯网络的状态估计/image-20241108174801806.png" alt="image-20241108174801806" style="zoom:80%;" /></p><p>​                                                                    </p><p>​                                                            <img src="/img/基于贝叶斯网络的状态估计/image-20241108175040161.png" alt="image-20241108175040161" style="zoom:80%;" /></p><h4 id="无迹卡尔曼滤波（非线性高斯系统）"><a href="#无迹卡尔曼滤波（非线性高斯系统）" class="headerlink" title="无迹卡尔曼滤波（非线性高斯系统）"></a>无迹卡尔曼滤波（非线性高斯系统）</h4><p>​         如果 <em>x</em> 的不确定性和函数 <em>g</em> 的非线性度都小，那么扩展卡尔曼滤波（EKF）中线性化近似效果是好的。但是，当 <em>x</em> 的不确定性和函数 <em>g</em> 的非线性度较大时，扩展卡尔曼滤波（EKF）的近似效果就不好了，此时可以用无迹卡尔曼滤波（UKF）来处理。</p><p>​        无迹卡尔曼滤波中采用的线性化技术也叫无迹变换。选取高斯分布 <em>P(X)</em> 上的 <em>σ</em> 点，然后将这些 <em>σ</em> 点经过 <em>g(x)</em> 变换，利用变换后的点推算出变换后的高斯分布均值和协方差矩阵。</p><p>​                                                        <img src="/img/基于贝叶斯网络的状态估计/image-20241108175727542.png" alt="image-20241108175727542" style="zoom:80%;" /></p><h3 id="信息滤波"><a href="#信息滤波" class="headerlink" title="信息滤波"></a>信息滤波</h3><h4 id="线性信息滤波（线性高斯系统）"><a href="#线性信息滤波（线性高斯系统）" class="headerlink" title="线性信息滤波（线性高斯系统）"></a>线性信息滤波（线性高斯系统）</h4><p>​        在矩参数表示的多维高斯分布中    </p><p>​                                                    <img src="/img/基于贝叶斯网络的状态估计/image-20241108170240461.png" alt="image-20241108170240461" style="zoom:80%;" /></p><p>​        将矩参数转换成正则参数（信息矩阵和信息向量）：</p><p>​                                                                                        <img src="/img/基于贝叶斯网络的状态估计/image-20241108180026146.png" alt="image-20241108180026146" style="zoom:80%;" /></p><p>​        那么正则参数形式的多维高斯分布为：</p><p>​                                            <img src="/img/基于贝叶斯网络的状态估计/image-20241108181223300.png" alt="image-20241108181223300" style="zoom:80%;" /></p><p>​        矩参数和正则参数只是表示高斯分布的两种不同方式，分布的本质是一样的，因此，线性信息滤波的推导与线性卡尔曼滤波是类似的。</p><p>​                                                                                <img src="/img/基于贝叶斯网络的状态估计/image-20241108181402340.png" alt="image-20241108181402340" style="zoom:80%;" /></p><ul><li><p>可以发现线性卡尔曼滤波和线性信息滤波的性能是对偶的。</p></li><li><p>线性卡尔曼滤波中的运动预测是增量的，而线性信息滤波中的运动预测需要求矩阵逆运算，所以线性卡尔曼滤波在运动预测上计算效率更高。</p></li><li><p>不过，线性卡尔曼滤波中的观测更新需要求矩阵逆运算，而线性信息滤波中的观测更新是增量的，所以线性信息滤波在观测更新上计算效率更高。</p></li></ul><h4 id="扩展信息滤波（非线性高斯系统）"><a href="#扩展信息滤波（非线性高斯系统）" class="headerlink" title="扩展信息滤波（非线性高斯系统）"></a>扩展信息滤波（非线性高斯系统）</h4><p>​        对于非线性高斯系统，扩展信息滤波与扩展卡尔曼滤波是类似的，也需要对实际非线性系统进行线性化近似处理。</p><p>​                                                                            <img src="/img/基于贝叶斯网络的状态估计/image-20241108181624317.png" alt="image-20241108181624317" style="zoom:80%;" /></p><h2 id="非参数化实现"><a href="#非参数化实现" class="headerlink" title="非参数化实现"></a>非参数化实现</h2><p>​        当分布不是高斯分布这种可以使用参数描述的特殊形式时，就需要用一个无限维概率密度函数描述。下面介绍两种非参数化方法，即直方图滤波和粒子滤波。</p><p><img src="/img/基于贝叶斯网络的状态估计/image-20241108181921687.png" alt="image-20241108181921687" style="zoom:80%;" /></p><h3 id="直方图滤波"><a href="#直方图滤波" class="headerlink" title="直方图滤波"></a>直方图滤波</h3><p>​        可以认为是用<strong>区域划分</strong>方法对待估量的状态空间进行离散化，用每个划分区域上质心的概率代表整个区域的概率大小。    </p><p>​        离散化的概率运动模型：</p><p>​                                                                            <img src="/img/基于贝叶斯网络的状态估计/image-20241108182055364.png" alt="image-20241108182055364" style="zoom:80%;" /></p><p>​        离散化的概率观测模型：</p><p>​                                                                                <img src="/img/基于贝叶斯网络的状态估计/image-20241108182246670.png" alt="image-20241108182246670" style="zoom:80%;" /></p><p>​        将递归贝叶斯滤波离散化（遍历待估状态的所有离散区域）后得到：</p><p>​                                                                <img src="/img/基于贝叶斯网络的状态估计/image-20241108182320368.png" alt="image-20241108182320368" style="zoom:80%;" /></p><p>​                                                        </p><p>​                                                    <img src="/img/基于贝叶斯网络的状态估计/image-20241108182421731.png" alt="image-20241108182421731" style="zoom:80%;" /></p><h3 id="粒子滤波"><a href="#粒子滤波" class="headerlink" title="粒子滤波"></a>粒子滤波</h3><p>​        可以认为是用<strong>随机粒子点</strong>对待估量的状态空间进行离散化，用粒子点的稠密度代表该取值空间处的概率大小。</p><p>​                                                   <img src="/img/基于贝叶斯网络的状态估计/image-20241108182642800.png" alt="image-20241108182642800" style="zoom:80%;" /></p>]]></content>
      
      
      <categories>
          
          <category> SLAM 学习 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SLAM估计理论</title>
      <link href="/2024/09/03/SLAM%E4%BC%B0%E8%AE%A1%E7%90%86%E8%AE%BA/"/>
      <url>/2024/09/03/SLAM%E4%BC%B0%E8%AE%A1%E7%90%86%E8%AE%BA/</url>
      
        <content type="html"><![CDATA[<p>SLAM估计理论</p><blockquote><p>记录学习《机器人SLAM导航核心技术与实战》的一些知识，配套教学视频：<a href="https://www.bilibili.com/video/BV1jS4y1a7Lz/?spm_id_from=333.999.0.0">《机器人SLAM导航核心技术与实战》书籍配套教学视频</a></p></blockquote><p>​        不管是用贝叶斯网络还是因子图，SLAN问题用概率图模型得到表示后，接下来就是用<strong>可观测量推理不可观测量</strong>，也就是说SLAM问题求解过程是一个<strong>状态估计</strong>。</p><h2 id="估计量的性质"><a href="#估计量的性质" class="headerlink" title="估计量的性质"></a>估计量的性质</h2><h3 id="一致性"><a href="#一致性" class="headerlink" title="一致性"></a>一致性</h3><p>从强到弱：</p><ul><li><p>依概率1收敛（几乎处处收敛）：<img src="/img/SLAM估计理论/image-20241030224245858.png" alt="image-20241030224245858" style="zoom: 33%;" /></p></li><li><p>依概率收敛（测度收敛）：<img src="/img/SLAM估计理论/image-20241030224335156.png" alt="image-20241030224335156" style="zoom: 33%;" /></p></li><li><p>依分布收敛：<img src="/img/SLAM估计理论/image-20241030224412417.png" alt="image-20241030224412417" style="zoom:33%;" /></p></li><li><p>依范数收敛：<img src="/img/SLAM估计理论/image-20241030224432552.png" alt="image-20241030224432552" style="zoom:33%;" /></p></li></ul><h3 id="偏差性"><a href="#偏差性" class="headerlink" title="偏差性"></a>偏差性</h3><ul><li>无偏估计：<img src="/img/SLAM估计理论/image-20241030224533324.png" alt="image-20241030224533324" style="zoom: 50%;" /></li><li>最小方差估计，方差越小估计不确定性越小</li></ul><h2 id="估计量的构建"><a href="#估计量的构建" class="headerlink" title="估计量的构建"></a>估计量的构建</h2><p>​         实际情况，观测到的样本数量不可能无穷多，因此一致性只是理论上需要满足的条件。在样本数量有限时，讨论估计值与实际值之间的偏差将更有意义，也就是偏差性。所以估计策略的目标是让估计量的偏差量尽量小，最小方差无偏估计无疑是一个理想的估计量。然而，最小方差无偏估计实现非常困难，因此需要寻找近似策略.</p><h3 id="最大似然估计（MLE）"><a href="#最大似然估计（MLE）" class="headerlink" title="最大似然估计（MLE）"></a>最大似然估计（MLE）</h3><p>​                                                                                                <img src="/img/SLAM估计理论/image-20241030224644697.png" alt="image-20241030224644697" style="zoom:50%;" /></p><p>​         最大似然估计假设概率分布模型是知道的，只是概率分布模型中的参数θ未知。尝试θ的不同取值，看模型是否能输出与观测结果一样的数据。当某个θ取值能让模型输出与观测结果一样的数据的概率最大，那么这个θ取值就是最适合的估计参数。</p><h3 id="最小二乘估计（LSE）"><a href="#最小二乘估计（LSE）" class="headerlink" title="最小二乘估计（LSE）"></a>最小二乘估计（LSE）</h3><p>​                                                                                                <img src="/img/SLAM估计理论/image-20241030224724912.png" alt="image-20241030224724912" style="zoom:50%;" /></p><p>​        最小二乘估计是计算观测样本点与模型实际点之间的平方误差，求使得该平方误差最小的参数值θ，求出来的这个参数值θ就是估计参数.</p><h3 id="贝叶斯估计（Bayes）"><a href="#贝叶斯估计（Bayes）" class="headerlink" title="贝叶斯估计（Bayes）"></a>贝叶斯估计（Bayes）</h3><p>​                                                                                        <img src="/img/SLAM估计理论/image-20241030224804930.png" alt="image-20241030224804930" style="zoom:50%;" /></p><p>​        贝叶斯估计首先也是构建关于误差的代价函数，然后最小化代价函数在概率密度下的期望.</p><p>​        可以看出，贝叶斯估计中的C(e)是关于误差e的抽象函数，也就是说贝叶斯估计是一个通用的形式，具体的估计量形式与函数C(e)的具体实现有关。最小均方误差估计和最大后验估计，就是贝叶斯估计的常见形式。</p><h4 id="最小均方误差估计（MMSE）"><a href="#最小均方误差估计（MMSE）" class="headerlink" title="最小均方误差估计（MMSE）"></a>最小均方误差估计（MMSE）</h4><p>​                                                                            <img src="/img/SLAM估计理论/image-20241030225040542.png" alt="image-20241030225040542" style="zoom:50%;" /></p><p>​            化简后：</p><p>​                                                                            <img src="/img/SLAM估计理论/image-20241030225104190.png" alt="image-20241030225104190" style="zoom:50%;" /></p><h4 id="最大后验估计（MAP）"><a href="#最大后验估计（MAP）" class="headerlink" title="最大后验估计（MAP）"></a>最大后验估计（MAP）</h4><p>​                                                                                <img src="/img/SLAM估计理论/image-20241030225127421.png" alt="image-20241030225127421" style="zoom:50%;" /></p><p>​            化简后：</p><p>​                                                                                            <img src="/img/SLAM估计理论/image-20241030225212080.png" alt="image-20241030225212080" style="zoom: 50%;" /></p><h2 id="各估计量等价转换关系"><a href="#各估计量等价转换关系" class="headerlink" title="各估计量等价转换关系"></a>各估计量等价转换关系</h2><p><img src="/img/SLAM估计理论/image-20241030225531570.png" alt="image-20241030225531570" style="zoom:67%;" /></p>]]></content>
      
      
      <categories>
          
          <category> SLAM 学习 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SLAM概率理论</title>
      <link href="/2024/09/02/SLAM%E6%A6%82%E7%8E%87%E7%90%86%E8%AE%BA/"/>
      <url>/2024/09/02/SLAM%E6%A6%82%E7%8E%87%E7%90%86%E8%AE%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="SLAM概率理论"><a href="#SLAM概率理论" class="headerlink" title="SLAM概率理论"></a>SLAM概率理论</h1><blockquote><p>记录学习《机器人SLAM导航核心技术与实战》的一些知识，配套教学视频：<a href="https://www.bilibili.com/video/BV1jS4y1a7Lz/?spm_id_from=333.999.0.0">《机器人SLAM导航核心技术与实战》书籍配套教学视频</a></p></blockquote><p>​        机器人问题中存在不确定性，包括传感器测量噪声、电机控制偏差、计算机软件计算精度近似等等。利用概率描述机器人中的不确定性，这样机器人中的不确定性就可以在概率理论框架下被计算和推演，即所谓的概率机器人学。下图是一个经典的例子。</p><p><img src="/img/SLAM概率理论/image-20241030185552839.png" alt="image-20241030185552839" style="zoom: 33%;" /></p><h2 id="状态估计问题"><a href="#状态估计问题" class="headerlink" title="状态估计问题"></a>状态估计问题</h2><ul><li>状态（感兴趣的物理量）<ul><li>直接状态</li><li>间接状态</li></ul></li><li>估计（猜测）<ul><li>猜测方法（概率理论）</li><li>猜测依据（观测数据）</li></ul></li></ul><p>​    不能直接准确测量的物理量就需要进行状态估计。</p><p>​        状态估计问题在SLAM中的体现：</p><p><img src="/img/SLAM概率理论/image-20241030190634546.png" alt="image-20241030190634546" style="zoom:67%;" /></p><p>​        概率描述：</p><p><img src="/img/SLAM概率理论/image-20241030190649256.png" alt="image-20241030190649256" style="zoom:67%;" /></p><h2 id="概率运动模型"><a href="#概率运动模型" class="headerlink" title="概率运动模型"></a>概率运动模型</h2><h3 id="速度运动模型"><a href="#速度运动模型" class="headerlink" title="速度运动模型"></a>速度运动模型</h3><p><img src="/img/SLAM概率理论/image-20241030191111725.png" alt="image-20241030191111725" style="zoom:50%;" /></p><p>​        状态转移方程：</p><p><img src="/img/SLAM概率理论/image-20241030191213093.png" alt="image-20241030191213093" style="zoom: 80%;" /></p><p>​        误差描述：</p><p><img src="/img/SLAM概率理论/image-20241030191444950.png" alt="image-20241030191444950" style="zoom: 67%;" /></p><h3 id="里程计运动模型"><a href="#里程计运动模型" class="headerlink" title="里程计运动模型"></a>里程计运动模型</h3><p><img src="/img/SLAM概率理论/image-20241030191542869.png" alt="image-20241030191542869" style="zoom:50%;" /></p><p>​        状态转移方程：</p><p><img src="/img/SLAM概率理论/image-20241030191608931.png" alt="image-20241030191608931" style="zoom:67%;" /></p><p>​        误差描述：</p><p><img src="/img/SLAM概率理论/image-20241030191648759.png" alt="image-20241030191648759" style="zoom:67%;" /></p><h2 id="概率观测模型"><a href="#概率观测模型" class="headerlink" title="概率观测模型"></a>概率观测模型</h2><h3 id="激光"><a href="#激光" class="headerlink" title="激光"></a>激光</h3><h4 id="波束模型"><a href="#波束模型" class="headerlink" title="波束模型"></a>波束模型</h4><p><img src="/img/SLAM概率理论/image-20241030192229260.png" alt="image-20241030192229260" style="zoom:67%;" /></p><p>波束模型缺乏光滑性，导致构建的地图具有很多毛刺。</p><h4 id="似然域模型"><a href="#似然域模型" class="headerlink" title="似然域模型"></a>似然域模型</h4><p><img src="/img/SLAM概率理论/image-20241030192301892.png" alt="image-20241030192301892" style="zoom:67%;" /></p><p>似然域模型较为光滑，构建的地图不易出现毛刺。</p><p>两个模型都是 大量实践数据归纳总结出来的。</p><h2 id="概率图模型"><a href="#概率图模型" class="headerlink" title="概率图模型"></a>概率图模型</h2><p>​        利用概率图模型来描述运动模型与观测模型之间的概率关系。</p><p><img src="/img/SLAM概率理论/image-20241030212121756.png" alt="image-20241030212121756" style="zoom:50%;" /></p><p>​        概率图模型分类：</p><p><img src="/img/SLAM概率理论/image-20241030212218847.png" alt="image-20241030212218847" style="zoom:67%;" /></p><h3 id="贝叶斯网络"><a href="#贝叶斯网络" class="headerlink" title="贝叶斯网络"></a>贝叶斯网络</h3><h4 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h4><ol><li>模型如图所示，箭头表示随机变量之间依赖的因果关系。</li></ol><p><img src="/img/SLAM概率理论/image-20241030212248378.png" alt="image-20241030212248378" style="zoom: 80%;" /></p><ol><li>联合分布</li></ol><p>​        根据条件独立性，可以得到联合分布的化简形式：</p><p><img src="/img/SLAM概率理论/image-20241030212443265.png" alt="image-20241030212443265"></p><p>​        联合分布化简的一般形式：</p><p><img src="/img/SLAM概率理论/image-20241030212530944.png" alt="image-20241030212530944" style="zoom: 50%;" /></p><h4 id="表示SLAM问题"><a href="#表示SLAM问题" class="headerlink" title="表示SLAM问题"></a>表示SLAM问题</h4><h5 id="静态贝叶斯网络"><a href="#静态贝叶斯网络" class="headerlink" title="静态贝叶斯网络"></a>静态贝叶斯网络</h5><ol><li>表示</li></ol><p><img src="/img/SLAM概率理论/image-20241030212752006.png" alt="image-20241030212752006" style="zoom:50%;" /></p><ol><li>学习</li></ol><p>​    需要学习模型结构和模型参数</p><ol><li>推理</li></ol><p>​    给定预测、先验信息（模型结构、参数）、预测结果</p><p><img src="/img/SLAM概率理论/image-20241030212855453.png" alt="image-20241030212855453" style="zoom:50%;" /></p><h5 id="动态贝叶斯网络"><a href="#动态贝叶斯网络" class="headerlink" title="动态贝叶斯网络"></a>动态贝叶斯网络</h5><ol><li>表示SLAM问题</li></ol><p><img src="/img/SLAM概率理论/image-20241030213006209.png" alt="image-20241030213006209" style="zoom: 67%;" /></p><ol><li>学习</li><li>推理</li></ol><p><img src="/img/SLAM概率理论/image-20241030213035125.png" alt="image-20241030213035125" style="zoom:67%;" /></p><h3 id="马尔可夫网络"><a href="#马尔可夫网络" class="headerlink" title="马尔可夫网络"></a>马尔可夫网络</h3><ol><li>模型如下图所示，连线表示随机变量之间隐式相关性，可以表示循环依赖。团中的节点必须两两之间都有连接（团的定义），团的势能函数是一个抽象函数，需要在实际问题中具体化为特定形式。不能再加入节点的团是最大团。最大团之间具有条件独立性。</li></ol><p><img src="/img/SLAM概率理论/image-20241030213206981.png" alt="image-20241030213206981" style="zoom:50%;" /></p><ol><li>联合分布</li></ol><p>​        联合分布化简形式：</p><p><img src="/img/SLAM概率理论/image-20241030213527864.png" alt="image-20241030213527864" style="zoom:80%;" /></p><p>​        联合分布最大团化简形式</p><p><img src="/img/SLAM概率理论/image-20241030213624656.png" alt="image-20241030213624656" style="zoom:67%;" /></p><p>​        一般形式</p><p><img src="/img/SLAM概率理论/image-20241030213645193.png" alt="image-20241030213645193" style="zoom: 50%;" /></p><h3 id="因子图"><a href="#因子图" class="headerlink" title="因子图"></a>因子图</h3><h4 id="马尔可夫网络转换成因子图"><a href="#马尔可夫网络转换成因子图" class="headerlink" title="马尔可夫网络转换成因子图"></a>马尔可夫网络转换成因子图</h4><ul><li><p>马尔可夫网络中团的势能函数只能笼统表示团内节点之间的相关性。</p></li><li><p>将团的势能函数进行因式分解，分解出来的因子项对随机变量之间的关系描述更具体。、</p></li><li><p>由于因式分解不唯一，所以马尔可夫网络到因子图的转换也不唯一。</p></li></ul><p><img src="/img/SLAM概率理论/image-20241030213856355.png" alt="image-20241030213856355" style="zoom:50%;" /></p><p>​        联合分布因子项化简形式：</p><ul><li><img src="/img/SLAM概率理论/image-20241030214036511.png" alt="image-20241030214036511" style="zoom:50%;" /></li><li><img src="/img/SLAM概率理论/image-20241030214054003.png" alt="image-20241030214054003" style="zoom:50%;" /></li></ul><h4 id="贝叶斯网络转换成因子图"><a href="#贝叶斯网络转换成因子图" class="headerlink" title="贝叶斯网络转换成因子图"></a>贝叶斯网络转换成因子图</h4><p>​        贝叶斯网络表示的SLAM问题：</p><p><img src="/img/SLAM概率理论/image-20241030214252421.png" alt="image-20241030214252421" style="zoom:67%;" /></p><p>​        将贝叶斯网络箭头的条件概率替换成因子图的最小二乘约束边，转化成最小二乘约束形式因子图表示的SLAM问题：</p><p><img src="/img/SLAM概率理论/image-20241030215234739.png" alt="image-20241030215234739" style="zoom:67%;" /></p><p>​        转化过程：</p><ol><li><p>假设</p><p><img src="/img/SLAM概率理论/image-20241030215357960.png" alt="image-20241030215357960" style="zoom:50%;" />            <img src="/img/SLAM概率理论/image-20241030215435654.png" alt="image-20241030215435654" style="zoom: 67%;" /></p></li><li><p>SLAM问题表示（联合分布）：</p></li></ol><p><img src="/img/SLAM概率理论/image-20241030215520242.png" alt="image-20241030215520242" style="zoom:67%;" /></p><ol><li>SLAM问题推理：</li></ol><p>​        利用给定观测状态估计未知状态，比如最大后验估计</p><p>​                                                                                        <img src="/img/SLAM概率理论/image-20241030215617294.png" alt="image-20241030215617294" style="zoom: 50%;" /></p><p>​        在获得直接量测信息U和Z后,利用条件概率分布关系对不可量测信息X和m进行推理，这就是SLAM问题的状态估计过程。</p><p>​                                                                    <img src="/img/SLAM概率理论/image-20241030215636683.png" alt="image-20241030215636683" style="zoom:50%;" /></p><p>​        由于估计过程关心的是X和M，所以可以用运动和观测这两个约束来构建因子函数，将不关心的U、Z隐藏到因子函数约束中。得到最小二乘估计：</p><p>​                                            <img src="/img/SLAM概率理论/image-20241030215945493.png" alt="image-20241030215945493" style="zoom:67%;" /></p><p>​        上面推导遵循以下假设：</p><ul><li>假设运动噪声和观测噪声都是0均值高斯分布</li><li>用运动误差和观测误差分别来构造运动约束和观测约束这2种因子项</li><li>误差项采用分布的协方差矩阵加权求和</li></ul>]]></content>
      
      
      <categories>
          
          <category> SLAM 学习 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>初识SLAM</title>
      <link href="/2024/09/01/%E5%88%9D%E8%AF%86SLAM/"/>
      <url>/2024/09/01/%E5%88%9D%E8%AF%86SLAM/</url>
      
        <content type="html"><![CDATA[<h1 id="初识SLAM"><a href="#初识SLAM" class="headerlink" title="初识SLAM"></a>初识SLAM</h1><blockquote><p>记录学习《机器人SLAM导航核心技术与实战》的一些知识，配套教学视频：<a href="https://www.bilibili.com/video/BV1jS4y1a7Lz/?spm_id_from=333.999.0.0">《机器人SLAM导航核心技术与实战》书籍配套教学视频</a></p></blockquote><h2 id="SLAM是什么"><a href="#SLAM是什么" class="headerlink" title="SLAM是什么"></a>SLAM是什么</h2><p>​         SLAM （同时定位与建图）并不仅仅指代某种特定算法，SLAM是一种问题的总称。常见的Gmapping、cartographer、LOAM、ORB-SLAM等都是SLAM的一种求解方法，也叫算法。</p><p>​        目前SLAM的概念已经泛化，被定位、导航、自主移动等应用的笼统习惯指代。</p><h2 id="SLAM的起源"><a href="#SLAM的起源" class="headerlink" title="SLAM的起源"></a>SLAM的起源</h2><h3 id="定位问题"><a href="#定位问题" class="headerlink" title="定位问题"></a>定位问题</h3><ul><li>参考物</li><li>相对关系<ul><li>直接<ul><li>欧式坐标</li><li>极坐标</li><li>球坐标</li><li>四叉树、八叉树</li><li>······</li></ul></li><li>间接<ul><li>拓扑描述</li><li>模糊描述</li><li>······</li></ul></li></ul></li></ul><blockquote><p>定位的本质都是提前部署参考物。</p><p>四叉树、八叉树是对位置从大到小逐渐细分，每次细分记录目标点所在的区域，如图所示。</p><p><img src="/img/初识SLAM/image-20241030172152849.png" alt="image-20241030172152849" style="zoom: 25%;" /></p></blockquote><h3 id="建图问题"><a href="#建图问题" class="headerlink" title="建图问题"></a>建图问题</h3><p>​        建图的本质都是基于已知位置切片的拼接。</p><h3 id="SLAM问题"><a href="#SLAM问题" class="headerlink" title="SLAM问题"></a>SLAM问题</h3><p>​        首先对比一下定位问题和建图问题：</p><ol><li>定位问题：</li></ol><ul><li>已知全局地图坐标信息</li><li>利用观测求解机器人在地图中的坐标</li></ul><ol><li>建图问题：</li></ol><ul><li><p>已知机器人的实时坐标</p></li><li><p>利用观测求解被观测物体的坐标</p><p>总的来说就是定位问题<strong>依靠地图信息推测定位信息</strong>，建图问题<strong>依靠定位信息推测地图信息</strong>。</p><p>两者相互依赖，故 <strong>SLAM问题需要同时解决定位和建图两个问题</strong>。</p></li></ul><p><img src="/img/初识SLAM/image-20241030173514291.png" alt="image-20241030173514291"></p><h3 id="导航问题"><a href="#导航问题" class="headerlink" title="导航问题"></a>导航问题</h3><p>​        从工程上看，自主移动实质上就是解决从地点A到地点B的问题。</p><ul><li>我在哪？ &gt;&gt;  取决于何种坐标系</li><li>我将到哪里去？  &gt;&gt;  取决于目的地在参考系下的描述方式</li><li>我该如何去？  &gt;&gt;  取决于路线和运动方式</li></ul><h2 id="数据关联、收敛和一致性"><a href="#数据关联、收敛和一致性" class="headerlink" title="数据关联、收敛和一致性"></a>数据关联、收敛和一致性</h2><h3 id="数据关联"><a href="#数据关联" class="headerlink" title="数据关联"></a>数据关联</h3><ul><li>不相关（定位丢失）</li><li>部分相关（增量建图）</li><li>强相关（闭环检测/重定位）</li></ul><h3 id="收敛性"><a href="#收敛性" class="headerlink" title="收敛性"></a>收敛性</h3><ul><li>数列收敛</li><li>级数收敛（绝对收敛、条件收敛）</li><li>函数收敛（定点收敛、无穷收敛、路径收敛）</li><li>函数序列收敛（逐点收敛、一致收敛）</li></ul><p><img src="/img/初识SLAM/image-20241030181151855.png" alt="image-20241030181151855" style="zoom: 33%;" /></p><h3 id="一致性"><a href="#一致性" class="headerlink" title="一致性"></a>一致性</h3><p><img src="/img/初识SLAM/image-20241030181442286.png" alt="image-20241030181442286" style="zoom: 33%;" /></p><p><img src="/img/初识SLAM/image-20241030181503802.png" alt="image-20241030181503802" style="zoom:33%;" /></p><h2 id="SLAM-的研究方向"><a href="#SLAM-的研究方向" class="headerlink" title="SLAM 的研究方向"></a>SLAM 的研究方向</h2><p><img src="/img/初识SLAM/image-20241030182054259.png" alt="image-20241030182054259" style="zoom: 33%;" /></p><p><img src="/img/初识SLAM/image-20241030182143296.png" alt="image-20241030182143296" style="zoom: 33%;" /></p><p><img src="/img/初识SLAM/image-20241030182235068.png" alt="image-20241030182235068"></p>]]></content>
      
      
      <categories>
          
          <category> SLAM 学习 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>gazebo仿真环境添加激光雷达</title>
      <link href="/2024/08/01/gazebo%E4%BB%BF%E7%9C%9F%E7%8E%AF%E5%A2%83%E6%B7%BB%E5%8A%A0%E6%BF%80%E5%85%89%E9%9B%B7%E8%BE%BE/"/>
      <url>/2024/08/01/gazebo%E4%BB%BF%E7%9C%9F%E7%8E%AF%E5%A2%83%E6%B7%BB%E5%8A%A0%E6%BF%80%E5%85%89%E9%9B%B7%E8%BE%BE/</url>
      
        <content type="html"><![CDATA[<h1 id="仿真环境添加传感器（二维激光雷达）"><a href="#仿真环境添加传感器（二维激光雷达）" class="headerlink" title="仿真环境添加传感器（二维激光雷达）"></a>仿真环境添加传感器（二维激光雷达）</h1><blockquote><p>前置文章：<a href="https://hins-h.github.io/2024/09/10/post-1/">gazebo无人机仿真环境配置</a></p></blockquote><h2 id="找到相应的model"><a href="#找到相应的model" class="headerlink" title="找到相应的model"></a>找到相应的model</h2><ol><li>运行source .bashrc，找到GAZEBO_MODEL_PATH，进入到GAZEBO_MODEL_PATH路径</li></ol><p><img src="/img/post-2/image-20240928164435052.png" alt="image-20240928164435052"></p><ol><li>查看model目录，每个文件夹是一个model。找到iris_rplidar，这就是我们要使用的model。</li></ol><p><img src="/img/post-2/image-20240928164553198.png" alt="image-20240928165005711"></p><ol><li><p>进入到iris_rplidar文件夹中，打开iris_rplidar.sdf文件，可以看到有若干个include标签，如lidar（雷达）、flow_cam（相机）、rplidar（二维激光雷达），说明该model包含上面三种传感器，这里我们需要注释lidar的部分，因为它会和rplidar冲突。如下图所示。</p><blockquote><p>注： <include>标签会根据<uri>标签去寻找相应的model，这个model也是在GAZEBO_MODEL_PATH路径下。进入到相应的文件夹中查看.sdf文件即为model定义文件。</p></blockquote></li></ol><p><img src="/img/post-2/image-20240928165005711.png" alt="image-20240928165005711"></p><ol><li><p>进入到rplidar文件夹中，打开model.sdf文件，需要修改其中一个参数，将range标签下的min的值从0.2改成0.4。</p><blockquote><p>range标签下的min和max是指激光扫到的最近距离和最远距离，当min=0.2时，会扫到机子自身，故将其改大。</p></blockquote></li></ol><p><img src="/img/post-2/image-20240928230825160.png" alt="image-20240928230825160"></p><h2 id="编写launch文件"><a href="#编写launch文件" class="headerlink" title="编写launch文件"></a>编写launch文件</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;world_path&quot;</span> <span class="attr">default</span>=<span class="string">&quot;$(find px4)/Tools/simulation/gazebo/sitl_gazebo/worlds/empty.world&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;gui&quot;</span> <span class="attr">default</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;ns&quot;</span> <span class="attr">default</span>=<span class="string">&quot;/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;model&quot;</span> <span class="attr">default</span>=<span class="string">&quot;iris_rplidar&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;fcu_url&quot;</span> <span class="attr">default</span>=<span class="string">&quot;udp://:14540@localhost:14557&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;gcs_url&quot;</span> <span class="attr">default</span>=<span class="string">&quot;&quot;</span> /&gt;</span>   <span class="comment">&lt;!-- GCS link is provided by SITL --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;tgt_system&quot;</span> <span class="attr">default</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;tgt_component&quot;</span> <span class="attr">default</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;vehicle&quot;</span> <span class="attr">default</span>=<span class="string">&quot;iris&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;use_sim_time&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;tf&quot;</span> <span class="attr">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> <span class="attr">name</span>=<span class="string">&quot;tf_2Dlidar&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">args</span>=<span class="string">&quot;0 0 0 0 0 0 base_link rplidar_link 10&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- Launch PX4 SITL --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find px4)/launch/px4.launch&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;vehicle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg vehicle)&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Launch MavROS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">group</span> <span class="attr">ns</span>=<span class="string">&quot;$(arg ns)&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find mavros)/launch/node.launch&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;pluginlists_yaml&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(find mavros)/launch/px4_pluginlists.yaml&quot;</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Need to change the config file to get the tf topic and get local position in terms of local origin --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;config_yaml&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(find simulation)/config/px4_config.yaml&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;fcu_url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg fcu_url)&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;gcs_url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg gcs_url)&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;tgt_system&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg tgt_system)&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;tgt_component&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg tgt_component)&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Launch Gazebo --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find gazebo_ros)/launch/empty_world.launch&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;gui&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg gui)&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;world_name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg world_path)&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Spawn vehicle model --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;spawn_model&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;gazebo_ros&quot;</span> <span class="attr">type</span>=<span class="string">&quot;spawn_model&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">args</span>=<span class="string">&quot;-sdf -database $(arg model) -model $(arg vehicle)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>上面的launch文件中发布了一个坐标系转换（tf_2Dlidar），主要是为了发布雷达的坐标系rplidar_link，这样才能在rivz中看到雷达的数据。</p></blockquote><p>  启动launch文件，即可看到雷达和相机。查看雷达话题数据可以发现雷达正常运行。</p><p><img src="/img/post-2/image-20240928171115679.png" alt="image-20240928171115679"></p><p><img src="/img/post-2/image-20240928171936577.png" alt="image-20240928171936577"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>gazebo无人机仿真环境配置</title>
      <link href="/2024/08/01/gazebo%E6%97%A0%E4%BA%BA%E6%9C%BA%E4%BB%BF%E7%9C%9F%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
      <url>/2024/08/01/gazebo%E6%97%A0%E4%BA%BA%E6%9C%BA%E4%BB%BF%E7%9C%9F%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="虚拟机ubuntu20-04-gazebo无人机仿真环境配置"><a href="#虚拟机ubuntu20-04-gazebo无人机仿真环境配置" class="headerlink" title="虚拟机ubuntu20.04    gazebo无人机仿真环境配置"></a>虚拟机ubuntu20.04    gazebo无人机仿真环境配置</h1><blockquote><p>基本环境：ubuntu20.04、 ros1(noetic)</p></blockquote><h2 id="安装gaezbo"><a href="#安装gaezbo" class="headerlink" title="安装gaezbo"></a>安装gaezbo</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ros-noetic-gazebo-ros</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试是否安装成功</span></span><br><span class="line">gazebo --version</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">运行gazebo</span></span><br><span class="line">gazebo  </span><br></pre></td></tr></table></figure><h2 id="安装mavros"><a href="#安装mavros" class="headerlink" title="安装mavros"></a>安装mavros</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ros-noetic-mavros ros-noetic-mavros-extras</span><br></pre></td></tr></table></figure><h2 id="配置-PX4-Autopilot及编译PX4固件"><a href="#配置-PX4-Autopilot及编译PX4固件" class="headerlink" title="配置 PX4-Autopilot及编译PX4固件"></a>配置 PX4-Autopilot及编译PX4固件</h2><h3 id="下载资源"><a href="#下载资源" class="headerlink" title="下载资源"></a>下载资源</h3><p>将资源下载到虚拟机中并解压。将0添加PX4插件文件夹中的PX4-Autopilot1.zip解压到主目录下。完成后主目录中会有PX4-Autopilot文件夹，这就是PX4固件的工作空间。下面开始添加环境以及编译。</p><blockquote><p>相关资源下载：通过网盘分享的文件：source.zip<br>链接: <a href="https://pan.baidu.com/s/1InBqhAEsScbRCgjJ8qXEdQ?pwd=jgmi">https://pan.baidu.com/s/1InBqhAEsScbRCgjJ8qXEdQ?pwd=jgmi</a> 提取码: jgmi</p></blockquote><h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加python依赖</span></span><br><span class="line">sudo apt install python3-rosdep python3-rosinstall python3-rosinstall-generator python3-wstool build-essential</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在.bashrc中写入（方便知道gazebo的配置路径，后面需要用到！！）</span></span><br><span class="line">source ~/PX4-Autopilot/Tools/simulation/gazebo/setup_gazebo.bash ~/PX4-Autopilot/ ~/PX4-Autopilot/build/px4_sitl_default</span><br><span class="line">export ROS_PACKAGE_PATH=$ROS_PACKAGE_PATH:~/PX4-Autopilot</span><br><span class="line">export ROS_PACKAGE_PATH=$ROS_PACKAGE_PATH:~/PX4-Autopilot/Tools/sitl_gazebo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入PX4工作空间</span></span><br><span class="line">cd PX4-Autopilot</span><br><span class="line">sudo bash ./Tools/setup/ubuntu.sh  # 需要等待较长时间，且需要多次运行直到无报错信息</span><br><span class="line"></span><br><span class="line">reboot</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译 PX4固件</span></span><br><span class="line">cd ~/PX4-Autopilot</span><br><span class="line">make distclean</span><br><span class="line">make px4_sitl_default gazebo</span><br></pre></td></tr></table></figure><ol><li><strong>常见报错：</strong></li></ol><ul><li><p>报错：  ModuleNotFoundError: No module named ‘menuconfig’ CMake Error at</p><p>cmake/kconfig.cmake:6 (message): kconfiglib is not installed or not in PATH</p><p>please install using “pip3 install kconfiglib”</p><p>Call Stack (most recent call first): CMakeLists.txt:174 (include)</p><p><img src="/img/post-1/image-20240915204600813.png" alt="image-20240915204600813"></p><p><strong>解决方法：sudo -H python3 -m pip install kconfiglib</strong></p><p>与上面类似的报错（缺少包），直接根据提示安装对应包即可</p></li><li><p>报错：AttributeError: module ‘em’ has no attribute ‘Interpreter’</p><p><strong>解决方法：</strong></p><p><strong>sudo -H python3 -m pip uninstall em</strong></p><p><strong>sudo -H python3 -m pip install —ignore-installed empy</strong></p><p> 这里可能会持续出现一个报错</p><p><img src="/img/post-1/image-20240915204922261.png" alt="image-20240915204922261"></p><p>  <strong>解决方法：pip3 install empy==3.3.4</strong></p></li><li><p>报错：ModuleNotFoundError: No module named ‘future’、</p><p><strong>解决方法：</strong></p><p><strong>sudo -H python3 -m pip install —ignore-installed future</strong></p></li><li><p>报错：CMake Error at CMakeLists.txt:235 (project): The CMAKE_C_COMPILER:</p><p>arm-none-eabi-gcc  is not a full path and was not found in the PATH.</p><p><strong>解决方法：</strong></p><p><strong>sudo apt-get install gcc-arm-none-eabi</strong></p></li></ul><ol><li><strong>编译成功后终端出现PX4的字样和打开的Gazebo界面</strong></li></ol><p><img src="/img/post-1/image-20240915205622926.png" alt="image-20240915205622926"></p><p><img src="/img/post-1/1.png" alt="image-20240915205627341"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">完成上面的编译后</span></span><br><span class="line">cd ~/PX4-Autopilot</span><br><span class="line">make px4_fmu-v5_default</span><br></pre></td></tr></table></figure><ol><li><strong>常见报错：</strong></li></ol><p><img src="/img/post-1/image-20241007214718028.png" alt="image-20241007214718028"></p><p>解决方法：sudo apt-get install gcc-arm-none-eabi</p><ol><li>编译成功</li></ol><p><img src="/img/post-1/image-20241007214801299.png" alt="image-20241007214801299"></p><h3 id="其他配置"><a href="#其他配置" class="headerlink" title="其他配置"></a>其他配置</h3><ol><li>添加usr.share.GeographicLib</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入到下载的资源中的 1添加usr.share.GeographicLib 文件夹中</span></span><br><span class="line">sudo cp -r  emm2015 /usr/share/GeographicLib/</span><br><span class="line">cd egm96-5</span><br><span class="line">sudo cp -r geoids/ /usr/share/GeographicLib</span><br><span class="line">cd /emm2015</span><br><span class="line">sudo cp -r magnetic /usr/share/GeographicLib</span><br></pre></td></tr></table></figure><p>确定GeographicLib文件夹中有着三个文件夹</p><p><img src="/img/post-1/image-20241007215346356.png" alt="image-20241007214801299"></p><ol><li>刷新mavros环境</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入到 2刷新mavros环境 文件夹中</span></span><br><span class="line">cp install_geographiclib_datasets.sh ~/</span><br><span class="line">chmod +x install_geographiclib_datasets.sh</span><br><span class="line">sudo ./install_geographiclib_datasets.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试</span></span><br><span class="line">roslaunch px4 mavros_posix_sitl.launch</span><br></pre></td></tr></table></figure><p>运行结果：</p><p><img src="/img/post-1/2.png" alt="image-20241007214801299"></p><h2 id="编写launch文件启动仿真环境"><a href="#编写launch文件启动仿真环境" class="headerlink" title="编写launch文件启动仿真环境"></a>编写launch文件启动仿真环境</h2><ol><li>创建airhust_ws工作空间，并在工作空间内创建simulation功能包。将source ~/airhust_ws/devel/setup.bash写入.bashrc中。</li><li>在simulation下创建config文件夹，并创建文件px4_config.yaml（px4参数配置）,在使用launch文件启动仿真环境时需要用到，具体内容如下:</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Common configuration for PX4 autopilot</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># node:</span></span><br><span class="line"><span class="attr">startup_px4_usb_quirk:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- system plugins ---</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sys_status &amp; sys_time connection options</span></span><br><span class="line"><span class="attr">conn:</span></span><br><span class="line">  <span class="attr">heartbeat_rate:</span> <span class="number">1.0</span>    <span class="comment"># send hertbeat rate in Hertz</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="number">10.0</span>          <span class="comment"># hertbeat timeout in seconds</span></span><br><span class="line">  <span class="attr">timesync_rate:</span> <span class="number">10.0</span>    <span class="comment"># TIMESYNC rate in Hertz (feature disabled if 0.0)</span></span><br><span class="line">  <span class="attr">system_time_rate:</span> <span class="number">1.0</span>  <span class="comment"># send system time to FCU rate in Hertz (disabled if 0.0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sys_status</span></span><br><span class="line"><span class="attr">sys:</span></span><br><span class="line">  <span class="attr">min_voltage:</span> <span class="number">10.0</span>   <span class="comment"># diagnostics min voltage</span></span><br><span class="line">  <span class="attr">disable_diag:</span> <span class="literal">false</span> <span class="comment"># disable all sys_status diagnostics, except heartbeat</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sys_time</span></span><br><span class="line"><span class="attr">time:</span></span><br><span class="line">  <span class="attr">time_ref_source:</span> <span class="string">&quot;fcu&quot;</span>  <span class="comment"># time_reference source</span></span><br><span class="line">  <span class="attr">timesync_mode:</span> <span class="string">MAVLINK</span></span><br><span class="line">  <span class="attr">timesync_avg_alpha:</span> <span class="number">0.6</span> <span class="comment"># timesync averaging factor</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- mavros plugins (alphabetical order) ---</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3dr_radio</span></span><br><span class="line"><span class="attr">tdr_radio:</span></span><br><span class="line">  <span class="attr">low_rssi:</span> <span class="number">40</span>  <span class="comment"># raw rssi lower level for diagnostics</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># actuator_control</span></span><br><span class="line"><span class="comment"># None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># command</span></span><br><span class="line"><span class="attr">cmd:</span></span><br><span class="line">  <span class="attr">use_comp_id_system_control:</span> <span class="literal">false</span> <span class="comment"># quirk for some old FCUs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># dummy</span></span><br><span class="line"><span class="comment"># None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ftp</span></span><br><span class="line"><span class="comment"># None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># global_position</span></span><br><span class="line"><span class="attr">global_position:</span></span><br><span class="line">  <span class="attr">frame_id:</span> <span class="string">&quot;map&quot;</span>             <span class="comment"># origin frame</span></span><br><span class="line">  <span class="attr">child_frame_id:</span> <span class="string">&quot;base_link&quot;</span> <span class="comment"># body-fixed frame</span></span><br><span class="line">  <span class="attr">rot_covariance:</span> <span class="number">99999.0</span>   <span class="comment"># covariance for attitude?</span></span><br><span class="line">  <span class="attr">gps_uere:</span> <span class="number">1.0</span>             <span class="comment"># User Equivalent Range Error (UERE) of GPS sensor (m)</span></span><br><span class="line">  <span class="attr">use_relative_alt:</span> <span class="literal">true</span>    <span class="comment"># use relative altitude for local coordinates</span></span><br><span class="line">  <span class="attr">tf:</span></span><br><span class="line">    <span class="attr">send:</span> <span class="literal">false</span>               <span class="comment"># send TF?</span></span><br><span class="line">    <span class="attr">frame_id:</span> <span class="string">&quot;map&quot;</span>  <span class="comment"># TF frame_id</span></span><br><span class="line">    <span class="attr">global_frame_id:</span> <span class="string">&quot;earth&quot;</span>  <span class="comment"># TF earth frame_id</span></span><br><span class="line">    <span class="attr">child_frame_id:</span> <span class="string">&quot;base_link&quot;</span> <span class="comment"># TF child_frame_id</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># imu_pub</span></span><br><span class="line"><span class="attr">imu:</span></span><br><span class="line">  <span class="attr">frame_id:</span> <span class="string">&quot;base_link&quot;</span></span><br><span class="line">  <span class="comment"># need find actual values</span></span><br><span class="line">  <span class="attr">linear_acceleration_stdev:</span> <span class="number">0.0003</span></span><br><span class="line">  <span class="attr">angular_velocity_stdev:</span> <span class="number">0.0003490659</span> <span class="string">//</span> <span class="number">0.02</span> <span class="string">degrees</span></span><br><span class="line">  <span class="attr">orientation_stdev:</span> <span class="number">1.0</span></span><br><span class="line">  <span class="attr">magnetic_stdev:</span> <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># local_position</span></span><br><span class="line"><span class="attr">local_position:</span></span><br><span class="line">  <span class="attr">frame_id:</span> <span class="string">&quot;odom&quot;</span></span><br><span class="line">  <span class="attr">tf:</span></span><br><span class="line">    <span class="attr">send:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">frame_id:</span> <span class="string">&quot;odom&quot;</span></span><br><span class="line">    <span class="attr">child_frame_id:</span> <span class="string">&quot;base_link&quot;</span></span><br><span class="line">    <span class="attr">send_fcu:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># param</span></span><br><span class="line"><span class="comment"># None, used for FCU params</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rc_io</span></span><br><span class="line"><span class="comment"># None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># safety_area</span></span><br><span class="line"><span class="attr">safety_area:</span></span><br><span class="line">  <span class="attr">p1:</span> &#123;<span class="attr">x:</span>  <span class="number">1.0</span>, <span class="attr">y:</span>  <span class="number">1.0</span>, <span class="attr">z:</span>  <span class="number">1.0</span>&#125;</span><br><span class="line">  <span class="attr">p2:</span> &#123;<span class="attr">x:</span> <span class="number">-1.0</span>, <span class="attr">y:</span> <span class="number">-1.0</span>, <span class="attr">z:</span> <span class="number">-1.0</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># setpoint_accel</span></span><br><span class="line"><span class="attr">setpoint_accel:</span></span><br><span class="line">  <span class="attr">send_force:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># setpoint_attitude</span></span><br><span class="line"><span class="attr">setpoint_attitude:</span></span><br><span class="line">  <span class="attr">reverse_thrust:</span> <span class="literal">false</span>     <span class="comment"># allow reversed thrust</span></span><br><span class="line">  <span class="attr">use_quaternion:</span> <span class="literal">false</span>     <span class="comment"># enable PoseStamped topic subscriber</span></span><br><span class="line">  <span class="attr">tf:</span></span><br><span class="line">    <span class="attr">listen:</span> <span class="literal">false</span>           <span class="comment"># enable tf listener (disable topic subscribers)</span></span><br><span class="line">    <span class="attr">frame_id:</span> <span class="string">&quot;map&quot;</span></span><br><span class="line">    <span class="attr">child_frame_id:</span> <span class="string">&quot;target_attitude&quot;</span></span><br><span class="line">    <span class="attr">rate_limit:</span> <span class="number">50.0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">setpoint_raw:</span></span><br><span class="line">  <span class="attr">thrust_scaling:</span> <span class="number">1.0</span>       <span class="comment"># used in setpoint_raw attitude callback.</span></span><br><span class="line">  <span class="comment"># <span class="doctag">Note:</span> PX4 expects normalized thrust values between 0 and 1, which means that</span></span><br><span class="line">  <span class="comment"># the scaling needs to be unitary and the inputs should be 01 as well.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># setpoint_position</span></span><br><span class="line"><span class="attr">setpoint_position:</span></span><br><span class="line">  <span class="attr">tf:</span></span><br><span class="line">    <span class="attr">listen:</span> <span class="literal">false</span>           <span class="comment"># enable tf listener (disable topic subscribers)</span></span><br><span class="line">    <span class="attr">frame_id:</span> <span class="string">&quot;map&quot;</span></span><br><span class="line">    <span class="attr">child_frame_id:</span> <span class="string">&quot;target_position&quot;</span></span><br><span class="line">    <span class="attr">rate_limit:</span> <span class="number">50.0</span></span><br><span class="line">  <span class="attr">mav_frame:</span> <span class="string">LOCAL_NED</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># setpoint_velocity</span></span><br><span class="line"><span class="attr">setpoint_velocity:</span></span><br><span class="line">  <span class="attr">mav_frame:</span> <span class="string">LOCAL_NED</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vfr_hud</span></span><br><span class="line"><span class="comment"># None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># waypoint</span></span><br><span class="line"><span class="attr">mission:</span></span><br><span class="line">  <span class="attr">pull_after_gcs:</span> <span class="literal">true</span>  <span class="comment"># update mission if gcs updates</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- mavros extras plugins (same order) ---</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># adsb</span></span><br><span class="line"><span class="comment"># None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># debug_value</span></span><br><span class="line"><span class="comment"># None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># distance_sensor</span></span><br><span class="line"><span class="comment">## Currently available orientations:</span></span><br><span class="line"><span class="comment">#    Check http://wiki.ros.org/mavros/Enumerations</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="attr">distance_sensor:</span></span><br><span class="line">  <span class="attr">hrlv_ez4_pub:</span></span><br><span class="line">    <span class="attr">id:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">frame_id:</span> <span class="string">&quot;hrlv_ez4_sonar&quot;</span></span><br><span class="line">    <span class="attr">orientation:</span> <span class="string">PITCH_270</span> <span class="comment"># RPY:&#123;0.0, 270.0, 0.0&#125; - downward-facing</span></span><br><span class="line">    <span class="attr">field_of_view:</span> <span class="number">0.0</span>  <span class="comment"># XXX TODO</span></span><br><span class="line">    <span class="attr">send_tf:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">sensor_position:</span> &#123;<span class="attr">x:</span>  <span class="number">0.0</span>, <span class="attr">y:</span>  <span class="number">0.0</span>, <span class="attr">z:</span>  <span class="number">-0.1</span>&#125;</span><br><span class="line">  <span class="attr">lidarlite_pub:</span></span><br><span class="line">    <span class="attr">id:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">frame_id:</span> <span class="string">&quot;lidarlite_laser&quot;</span></span><br><span class="line">    <span class="attr">orientation:</span> <span class="string">PITCH_270</span></span><br><span class="line">    <span class="attr">field_of_view:</span> <span class="number">0.0</span>  <span class="comment"># XXX TODO</span></span><br><span class="line">    <span class="attr">send_tf:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">sensor_position:</span> &#123;<span class="attr">x:</span>  <span class="number">0.0</span>, <span class="attr">y:</span>  <span class="number">0.0</span>, <span class="attr">z:</span>  <span class="number">-0.1</span>&#125;</span><br><span class="line">  <span class="attr">sonar_1_sub:</span></span><br><span class="line">    <span class="attr">subscriber:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">id:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">orientation:</span> <span class="string">PITCH_270</span></span><br><span class="line">  <span class="attr">laser_1_sub:</span></span><br><span class="line">    <span class="attr">subscriber:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">id:</span> <span class="number">3</span></span><br><span class="line">    <span class="attr">orientation:</span> <span class="string">PITCH_270</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># image_pub</span></span><br><span class="line"><span class="attr">image:</span></span><br><span class="line">  <span class="attr">frame_id:</span> <span class="string">&quot;px4flow&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># fake_gps</span></span><br><span class="line"><span class="attr">fake_gps:</span></span><br><span class="line">  <span class="comment"># select data source</span></span><br><span class="line">  <span class="attr">use_mocap:</span> <span class="literal">true</span>         <span class="comment"># ~mocap/pose</span></span><br><span class="line">  <span class="attr">mocap_transform:</span> <span class="literal">true</span>   <span class="comment"># ~mocap/tf instead of pose</span></span><br><span class="line">  <span class="attr">use_vision:</span> <span class="literal">false</span>       <span class="comment"># ~vision (pose)</span></span><br><span class="line">  <span class="comment"># origin (default: Zürich)</span></span><br><span class="line">  <span class="attr">geo_origin:</span></span><br><span class="line">    <span class="attr">lat:</span> <span class="number">47.3667</span>          <span class="comment"># latitude [degrees]</span></span><br><span class="line">    <span class="attr">lon:</span> <span class="number">8.5500</span>           <span class="comment"># longitude [degrees]</span></span><br><span class="line">    <span class="attr">alt:</span> <span class="number">408.0</span>            <span class="comment"># altitude (height over the WGS-84 ellipsoid) [meters]</span></span><br><span class="line">  <span class="attr">eph:</span> <span class="number">2.0</span></span><br><span class="line">  <span class="attr">epv:</span> <span class="number">2.0</span></span><br><span class="line">  <span class="attr">satellites_visible:</span> <span class="number">5</span>   <span class="comment"># virtual number of visible satellites</span></span><br><span class="line">  <span class="attr">fix_type:</span> <span class="number">3</span>             <span class="comment"># type of GPS fix (default: 3D)</span></span><br><span class="line">  <span class="attr">tf:</span></span><br><span class="line">    <span class="attr">listen:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">send:</span> <span class="literal">false</span>           <span class="comment"># send TF?</span></span><br><span class="line">    <span class="attr">frame_id:</span> <span class="string">&quot;map&quot;</span>       <span class="comment"># TF frame_id</span></span><br><span class="line">    <span class="attr">child_frame_id:</span> <span class="string">&quot;fix&quot;</span> <span class="comment"># TF child_frame_id</span></span><br><span class="line">    <span class="attr">rate_limit:</span> <span class="number">10.0</span>      <span class="comment"># TF rate</span></span><br><span class="line">  <span class="attr">gps_rate:</span> <span class="number">5.0</span>           <span class="comment"># GPS data publishing rate</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># landing_target</span></span><br><span class="line"><span class="attr">landing_target:</span></span><br><span class="line">  <span class="attr">listen_lt:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">mav_frame:</span> <span class="string">&quot;LOCAL_NED&quot;</span></span><br><span class="line">  <span class="attr">land_target_type:</span> <span class="string">&quot;VISION_FIDUCIAL&quot;</span></span><br><span class="line">  <span class="attr">image:</span></span><br><span class="line">    <span class="attr">width:</span> <span class="number">640</span>            <span class="comment"># [pixels]</span></span><br><span class="line">    <span class="attr">height:</span> <span class="number">480</span></span><br><span class="line">  <span class="attr">camera:</span></span><br><span class="line">    <span class="attr">fov_x:</span> <span class="number">2.0071286398</span>   <span class="comment"># default: 115 [degrees]</span></span><br><span class="line">    <span class="attr">fov_y:</span> <span class="number">2.0071286398</span></span><br><span class="line">  <span class="attr">tf:</span></span><br><span class="line">    <span class="attr">send:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">listen:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">frame_id:</span> <span class="string">&quot;landing_target&quot;</span></span><br><span class="line">    <span class="attr">child_frame_id:</span> <span class="string">&quot;camera_center&quot;</span></span><br><span class="line">    <span class="attr">rate_limit:</span> <span class="number">10.0</span></span><br><span class="line">  <span class="attr">target_size:</span> &#123;<span class="attr">x:</span>  <span class="number">0.3</span>, <span class="attr">y:</span>  <span class="number">0.3</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># mocap_pose_estimate</span></span><br><span class="line"><span class="attr">mocap:</span></span><br><span class="line">  <span class="comment"># select mocap source</span></span><br><span class="line">  <span class="attr">use_tf:</span> <span class="literal">false</span>   <span class="comment"># ~mocap/tf</span></span><br><span class="line">  <span class="attr">use_pose:</span> <span class="literal">true</span>  <span class="comment"># ~mocap/pose</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># odom</span></span><br><span class="line"><span class="attr">odometry:</span></span><br><span class="line">  <span class="attr">fcu:</span></span><br><span class="line">    <span class="attr">odom_parent_id_des:</span> <span class="string">&quot;map&quot;</span>    <span class="comment"># desired parent frame rotation of the FCU&#x27;s odometry</span></span><br><span class="line">    <span class="attr">odom_child_id_des:</span> <span class="string">&quot;base_link&quot;</span>    <span class="comment"># desired child frame rotation of the FCU&#x27;s odometry</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># px4flow</span></span><br><span class="line"><span class="attr">px4flow:</span></span><br><span class="line">  <span class="attr">frame_id:</span> <span class="string">&quot;px4flow&quot;</span></span><br><span class="line">  <span class="attr">ranger_fov:</span> <span class="number">0.118682</span>      <span class="comment"># 6.8 degrees at 5 meters, 31 degrees at 1 meter</span></span><br><span class="line">  <span class="attr">ranger_min_range:</span> <span class="number">0.3</span>     <span class="comment"># meters</span></span><br><span class="line">  <span class="attr">ranger_max_range:</span> <span class="number">5.0</span>     <span class="comment"># meters</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vision_pose_estimate</span></span><br><span class="line"><span class="attr">vision_pose:</span></span><br><span class="line">  <span class="attr">tf:</span></span><br><span class="line">    <span class="attr">listen:</span> <span class="literal">false</span>           <span class="comment"># enable tf listener (disable topic subscribers)</span></span><br><span class="line">    <span class="attr">frame_id:</span> <span class="string">&quot;odom&quot;</span></span><br><span class="line">    <span class="attr">child_frame_id:</span> <span class="string">&quot;vision_estimate&quot;</span></span><br><span class="line">    <span class="attr">rate_limit:</span> <span class="number">10.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vision_speed_estimate</span></span><br><span class="line"><span class="attr">vision_speed:</span></span><br><span class="line">  <span class="attr">listen_twist:</span> <span class="literal">true</span>    <span class="comment"># enable listen to twist topic, else listen to vec3d topic</span></span><br><span class="line">  <span class="attr">twist_cov:</span> <span class="literal">true</span>       <span class="comment"># enable listen to twist with covariance topic</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vibration</span></span><br><span class="line"><span class="attr">vibration:</span></span><br><span class="line">  <span class="attr">frame_id:</span> <span class="string">&quot;base_link&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># wheel_odometry</span></span><br><span class="line"><span class="attr">wheel_odometry:</span></span><br><span class="line">  <span class="attr">count:</span> <span class="number">2</span>           <span class="comment"># number of wheels to compute odometry</span></span><br><span class="line">  <span class="attr">use_rpm:</span> <span class="literal">false</span>     <span class="comment"># use wheel&#x27;s RPM instead of cumulative distance to compute odometry</span></span><br><span class="line">  <span class="attr">wheel0:</span> &#123;<span class="attr">x:</span> <span class="number">0.0</span>, <span class="attr">y:</span> <span class="number">-0.15</span>, <span class="attr">radius:</span> <span class="number">0.05</span>&#125; <span class="comment"># x-, y-offset (m,NED) and radius (m)</span></span><br><span class="line">  <span class="attr">wheel1:</span> &#123;<span class="attr">x:</span> <span class="number">0.0</span>, <span class="attr">y:</span>  <span class="number">0.15</span>, <span class="attr">radius:</span> <span class="number">0.05</span>&#125; <span class="comment"># x-, y-offset (m,NED) and radius (m)</span></span><br><span class="line">  <span class="attr">send_raw:</span> <span class="literal">true</span>              <span class="comment"># send wheel&#x27;s RPM and cumulative distance (~/wheel_odometry/rpm, ~/wheel_odometry/distance)</span></span><br><span class="line">  <span class="attr">send_twist:</span> <span class="literal">false</span>           <span class="comment"># send geometry_msgs/TwistWithCovarianceStamped instead of nav_msgs/Odometry</span></span><br><span class="line">  <span class="attr">frame_id:</span> <span class="string">&quot;odom&quot;</span>             <span class="comment"># origin frame</span></span><br><span class="line">  <span class="attr">child_frame_id:</span> <span class="string">&quot;base_link&quot;</span> <span class="comment"># body-fixed frame</span></span><br><span class="line">  <span class="attr">vel_error:</span> <span class="number">0.1</span>              <span class="comment"># wheel velocity measurement error 1-std (m/s)</span></span><br><span class="line">  <span class="attr">tf:</span></span><br><span class="line">    <span class="attr">send:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">frame_id:</span> <span class="string">&quot;odom&quot;</span></span><br><span class="line">    <span class="attr">child_frame_id:</span> <span class="string">&quot;base_link&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vim:set ts=2 sw=2 et:</span></span><br></pre></td></tr></table></figure><ol><li>在simulation下创建launch文件夹，并创建iris.launch文件</li></ol><p>​    需要注意的点：</p><ul><li>world_path参数：gazebo启动寻找的地图文件，world_path需要自己指定路径；</li><li>model参数：gazebo启动寻找的model文件。model的路径是GAZEBO_MODEL_PATH，该路径的值在source .bashrc之后能看到（在第6步安装px4的时候将几行命令写入.bashrc就是为了寻找model路径）。这里model的路径是~/PX4-Autopilot/Tools/simulation/gazebo/sitl_gazebo/models。px4官方包已经自带了一些无人机及相关传感器的model，后序如果想自己添加model，将相关文件放到GAZEBO_MODEL_PATH路径下即可被gazebo找到。</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;world_path&quot;</span> <span class="attr">default</span>=<span class="string">&quot;$(find px4)/Tools/simulation/gazebo/sitl_gazebo/worlds/empty.world&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;gui&quot;</span> <span class="attr">default</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;ns&quot;</span> <span class="attr">default</span>=<span class="string">&quot;/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;model&quot;</span> <span class="attr">default</span>=<span class="string">&quot;iris&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;fcu_url&quot;</span> <span class="attr">default</span>=<span class="string">&quot;udp://:14540@localhost:14557&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;gcs_url&quot;</span> <span class="attr">default</span>=<span class="string">&quot;&quot;</span> /&gt;</span>   <span class="comment">&lt;!-- GCS link is provided by SITL --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;tgt_system&quot;</span> <span class="attr">default</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;tgt_component&quot;</span> <span class="attr">default</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;vehicle&quot;</span> <span class="attr">default</span>=<span class="string">&quot;iris&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;use_sim_time&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">           </span><br><span class="line">    <span class="comment">&lt;!-- Launch PX4 SITL --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find px4)/launch/px4.launch&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;vehicle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg vehicle)&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Launch MavROS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">group</span> <span class="attr">ns</span>=<span class="string">&quot;$(arg ns)&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find mavros)/launch/node.launch&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;pluginlists_yaml&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(find mavros)/launch/px4_pluginlists.yaml&quot;</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Need to change the config file to get the tf topic and get local position in terms of local origin --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;config_yaml&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(find simulation)/config/px4_config.yaml&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;fcu_url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg fcu_url)&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;gcs_url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg gcs_url)&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;tgt_system&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg tgt_system)&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;tgt_component&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg tgt_component)&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Launch Gazebo --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find gazebo_ros)/launch/empty_world.launch&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;gui&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg gui)&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;world_name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg world_path)&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Spawn vehicle model --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;spawn_model&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;gazebo_ros&quot;</span> <span class="attr">type</span>=<span class="string">&quot;spawn_model&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">args</span>=<span class="string">&quot;-sdf -database $(arg model) -model $(arg vehicle)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>回到airhust_ws目录下catkin_make</li><li>运行以下命令即可</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch simulation iris.launch</span><br></pre></td></tr></table></figure><p>正常运行显示如下：</p><p><img src="/img/post-1/image-20241007220008340.png" alt="image-20241007220008340"></p><h2 id="下载地面站"><a href="#下载地面站" class="headerlink" title="下载地面站"></a>下载地面站</h2><p>​        按照官网教程下载即可</p><p>​        <a href="https://docs.qgroundcontrol.com/master/en/qgc-user-guide/getting_started/download_and_install.html">https://docs.qgroundcontrol.com/master/en/qgc-user-guide/getting_started/download_and_install.html</a></p><ul><li>地面站控制无人机起飞</li></ul><ol><li>打开qgc地面站，点击起飞</li></ol><p><img src="/img/post-1/image-20240918113142192.png" alt="image-20240918113142192"></p><ol><li>滑动解锁，无人机起飞升空</li></ol><p><img src="/img/post-1/image-20240918113240369.png" alt="image-20240918113240369"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>PX4相关硬件模块</title>
      <link href="/2024/01/11/PX4%E7%9B%B8%E5%85%B3%E7%A1%AC%E4%BB%B6%E6%A8%A1%E5%9D%97/"/>
      <url>/2024/01/11/PX4%E7%9B%B8%E5%85%B3%E7%A1%AC%E4%BB%B6%E6%A8%A1%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="PX4相关硬件模块"><a href="#PX4相关硬件模块" class="headerlink" title="PX4相关硬件模块"></a>PX4相关硬件模块</h1><blockquote><p>相关视频链接：<a href="https://www.bilibili.com/cheese/play/ep566011?csource=common_myclass_purchasedlecture_null&amp;spm_id_from=333.874.selfDef.mine_paid_list">新手必学！开源无人机飞控系统PX4开发入门_哔哩哔哩_bilibili</a></p></blockquote><h2 id="模块分类"><a href="#模块分类" class="headerlink" title="模块分类"></a>模块分类</h2><ul><li>动力系统：螺旋桨、电机、电调、电源等</li><li>控制系统：核心是以 PIXHAWK、赫星等核心运算和处理等功能的飞控板子。此外包括遥控器（接受机）、数传、图传等。其中数传和图传是在实现自主飞行时将作为图片输入到机载计算机的信息源头，某种意义可以理解为控制输入。</li><li>机架模块：由机身、起落架组成</li><li>外载模块：外载计算机（TX2、树莓派、NANO、NX等）、摄像头、雷达等</li><li>其他：减震、降噪、充电器、BB响等</li></ul><h2 id="PIXHAWK硬件V2-4-8-和-V4"><a href="#PIXHAWK硬件V2-4-8-和-V4" class="headerlink" title="PIXHAWK硬件V2.4.8 和 V4"></a>PIXHAWK硬件V2.4.8 和 V4</h2><h3 id="V2-4-8"><a href="#V2-4-8" class="headerlink" title="V2.4.8"></a>V2.4.8</h3><p><img src="/img/PX4相关硬件模块/image-20241029023552410-1730141182502-4.png" alt="image-20241029023552410" style="zoom:50%;" />                                     <img src="/img/PX4相关硬件模块/image-20241029023614944-1730141204134-6.png" alt="image-20241029023614944" style="zoom: 50%;" /></p><h4 id="V2-4-8-实际连接飞机的接线图"><a href="#V2-4-8-实际连接飞机的接线图" class="headerlink" title="V2.4.8 实际连接飞机的接线图"></a>V2.4.8 实际连接飞机的接线图</h4><p><img src="/img/PX4相关硬件模块/image-20241029023729266-1730141228735-8.png" alt="image-20241029023729266" style="zoom: 50%;" /></p><h4 id="V2-4-8引脚"><a href="#V2-4-8引脚" class="headerlink" title="V2.4.8引脚"></a>V2.4.8引脚</h4><h5 id="接口引脚"><a href="#接口引脚" class="headerlink" title="接口引脚"></a>接口引脚</h5><p><img src="/img/PX4相关硬件模块/30b319f0bb3d8199d4109127e221d3e2.png" alt="img" style="zoom: 67%;" /></p><p><img src="/img/PX4相关硬件模块/f8038467bb76fe8b325aef3e0e905c7b.png" alt="img" style="zoom: 67%;" /></p><h5 id="输出引脚"><a href="#输出引脚" class="headerlink" title="输出引脚"></a>输出引脚</h5><p><img src="/img/PX4相关硬件模块/e25a6983ce9cc10ebf09385cdc99ccb6.png" alt="img" style="zoom:67%;" /></p><p>​    正面向上，从左开始1-6是辅助通道，可以在地面站中添加。例如额外加入舵机实现多功能。7-14是主通道，最后是遥控器。</p><h4 id="主从处理器件"><a href="#主从处理器件" class="headerlink" title="主从处理器件"></a>主从处理器件</h4><p>​    Pixhawk 硬件整体分为了 PX4FMU 和 PX4IO。</p><ol><li>PX4FMU 主处理器件：STM32 f427。主要是用于数据获取、计算、控制等核心代码。</li><li>PX4IO 从处理器件：STM32 f100:8路主PWM。主要用于输出电机、电调、接收机等。</li></ol><blockquote><p>主从处理器使用串口通信</p></blockquote><h4 id="Bootloader操作系统"><a href="#Bootloader操作系统" class="headerlink" title="Bootloader操作系统"></a>Bootloader操作系统</h4><p>​    操作系统，分别在主从处理器中烧入。其作用是用于连接IMU等硬件和PX4、APM固件。</p><h3 id="PIXHAWK-V4"><a href="#PIXHAWK-V4" class="headerlink" title="PIXHAWK V4"></a>PIXHAWK V4</h3><p><img src="/img/PX4相关硬件模块/image-20241029025810369.png" alt="image-20241029025810369" style="zoom:50%;" /></p><h4 id="实际连接飞机接线图"><a href="#实际连接飞机接线图" class="headerlink" title="实际连接飞机接线图"></a>实际连接飞机接线图</h4><p><img src="/img/PX4相关硬件模块/image-20241029025839490.png" alt="image-20241029025839490"></p><h2 id="IMU-惯性测量单元（姿态数据源头）"><a href="#IMU-惯性测量单元（姿态数据源头）" class="headerlink" title="IMU 惯性测量单元（姿态数据源头）"></a>IMU 惯性测量单元（姿态数据源头）</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>Inertial Measurement Unit首字母的缩写，即惯性测量单元。</p><h3 id="组成"><a href="#组成" class="headerlink" title="组成"></a>组成</h3><p>主要由加速度计、陀螺仪、磁力计三部分组成。</p><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>​    测量当前载体的姿态信息（姿态解算），从而与期望的姿态进行差值计算，实现姿态控制。</p><p>​    姿态：三维姿态包括 横滚roll、俯仰pitch、偏航yaw</p><p><img src="/img/PX4相关硬件模块/image-20241029100551111.png" alt="image-20241029100551111" style="zoom:50%;" /></p><ul><li><strong>陀螺仪</strong>：直接可以得到角速度，积分即为角度。但存在零点漂移和温漂。校准时，是静止一段时间获得平均值。</li><li><strong>加速度计</strong>：测量在平面的加速度即roll 和 pitch（对振动很敏感、减震）。校准时，进行六面校准，利用每一轴的重力加速度来参考标定。</li><li><strong>磁力计</strong>：测量可得到载体的方向信息，即yaw。校准也是六面进行。</li></ul><h2 id="其他传感器"><a href="#其他传感器" class="headerlink" title="其他传感器"></a>其他传感器</h2><ul><li><strong>GPS</strong>：定位作用</li><li><strong>激光测距</strong>：测量距离作用（高度）（TFmini、PX4flow）</li><li><strong>气压计</strong>：高度测量作用。气压计通过不同海拔高度的气压不同，压电式气压计反馈得到高度数值。</li><li><strong>MOCAP</strong>：三维动作捕捉，<strong>室内</strong>三维定位</li><li><strong>UWB</strong>：超宽带（Ultra Wide Band），<strong>室内</strong>三维定位</li><li><strong>RTK</strong>：测RTK（Real - time kinematic，实时动态）载波相位差分技术，是实时处理两个测量站载波相位观测量的差分方法，将基准站采集的载波相位发给用户接收机，进行求差解算坐标。这是一种新的常用的卫星定位测量方法，<strong>室外</strong>三维定位。</li><li>雷达：测距</li><li>视觉（摄像头）：跟随、避障</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>PID算法</title>
      <link href="/2023/12/11/PID%E7%AE%97%E6%B3%95/"/>
      <url>/2023/12/11/PID%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="PID算法"><a href="#PID算法" class="headerlink" title="PID算法"></a>PID算法</h1><h2 id="PID算法一般形式"><a href="#PID算法一般形式" class="headerlink" title="PID算法一般形式"></a>PID算法一般形式</h2><p><img src="/img/PID算法/image-20241030150041067.png" alt="image-20241030150041067"></p><h2 id="基本形式"><a href="#基本形式" class="headerlink" title="基本形式"></a>基本形式</h2><p>​        PID 算法的流程主要是<strong>通过误差信号控制被控量</strong>，而控制器是比例、积分、微分三个环节的加和。这里规定（t时刻）：</p><ul><li>输入量为 rin(t)</li><li>输出量为 rout(t)</li><li>偏差量为 err(t) = rin(t) - rout(t)</li></ul><p>​        PID 的控制规律为</p><p>​    <img src="/img/PID算法/image-20241030150819617.png" alt="image-20241030150819617" style="zoom: 67%;" /></p><p>​        对比例、积分、微分环节的解释：</p><ul><li>如果偏差为0，则比例环节不起作用，只有<strong>存在偏差时</strong>才起作用。</li><li>积分环节主要是用来<strong>消除静差</strong>（系统稳定后输出值和设定值之间的差值），积分环节实际上就是偏差累计的过程，把累计的误差加到原有系统上以抵消系统造成的静差。</li><li>微分环节反应了偏差信号的变化规律，根据偏差信号的变化趋势来进行<strong>超前调节</strong>，从而增加系统快速性。</li></ul><h2 id="连续系统离散化（位置式）"><a href="#连续系统离散化（位置式）" class="headerlink" title="连续系统离散化（位置式）"></a>连续系统离散化（位置式）</h2><p>​        假设采样间隔为T，在第 K T 时刻：</p><ul><li>偏差： err(K) = rin(K) - rout(K)</li><li>积分：err(K) + err(K+1) + ···  （简化为用和来表示）</li><li>微分：(err(K) - err(K-1)) / T （简化为斜率表示）</li></ul><p>​        故 PID 离散表示形式：</p><p><img src="/img/PID算法/image-20241030151759514.png" alt="image-20241030151759514" style="zoom: 50%;" /></p><p>​        可表示为：</p><p><img src="/img/PID算法/image-20241030152247443.png" alt="image-20241030152247443" style="zoom:50%;" /></p><h2 id="连续系统离散化（增量式）"><a href="#连续系统离散化（增量式）" class="headerlink" title="连续系统离散化（增量式）"></a>连续系统离散化（增量式）</h2><p>​        由位置式公式可以得到</p><p>​    <img src="/img/PID算法/image-20241030152553675.png" alt="image-20241030152553675" style="zoom: 33%;" /></p><p>​        作差可以得到离散化 PID 的增量式表达方式</p><p>​    <img src="/img/PID算法/wps1-1730273437932-3.jpg" alt="img"></p><p>​        需要注意的是最终输出结果为</p><p>​        <img src="/img/PID算法/wps2.jpg" alt="img" style="zoom:80%;" /></p><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PID</span> &#123;</span><br><span class="line">  <span class="type">float</span> SetSpeed;</span><br><span class="line">  <span class="type">float</span> ActualSpeed;</span><br><span class="line">  <span class="type">float</span> err;</span><br><span class="line">  <span class="type">float</span> err_last; <span class="comment">// 前一次偏差</span></span><br><span class="line">  <span class="type">float</span> Kp, Ki, Kd;</span><br><span class="line">  <span class="type">float</span> voltage; <span class="comment">// 电压(控制执行器的变量)</span></span><br><span class="line">  <span class="type">float</span> integral;  <span class="comment">// 积分</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">PID</span>(<span class="type">float</span> Kp, <span class="type">float</span> Ki, <span class="type">float</span> Kd):<span class="built_in">SetSpeed</span>(<span class="number">0</span>), <span class="built_in">ActualSpeed</span>(<span class="number">0</span>), <span class="built_in">err</span>(<span class="number">0</span>), <span class="built_in">err_last</span>(<span class="number">0</span>), <span class="built_in">Kp</span>(Kp), <span class="built_in">Ki</span>(Ki), <span class="built_in">Kd</span>(Kd), <span class="built_in">voltage</span>(<span class="number">0</span>), <span class="built_in">integral</span>(<span class="number">0</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">float</span> <span class="title">PID_realize</span><span class="params">(<span class="type">float</span> speed)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;SetSpeed = speed;</span><br><span class="line">    <span class="keyword">this</span>-&gt;err = <span class="keyword">this</span>-&gt;SetSpeed - <span class="keyword">this</span>-&gt;ActualSpeed;</span><br><span class="line">    <span class="keyword">this</span>-&gt;integral += <span class="keyword">this</span>-&gt;err;</span><br><span class="line">    <span class="keyword">this</span>-&gt;voltage = <span class="keyword">this</span>-&gt;Kp * <span class="keyword">this</span>-&gt;err + <span class="keyword">this</span>-&gt;Ki * <span class="keyword">this</span>-&gt;integral + <span class="keyword">this</span>-&gt;Kd * (<span class="keyword">this</span>-&gt;err - <span class="keyword">this</span>-&gt;err_last); <span class="comment">// 增量式</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;err_last = <span class="keyword">this</span>-&gt;err;</span><br><span class="line">    <span class="keyword">this</span>-&gt;ActualSpeed = <span class="keyword">this</span>-&gt;voltage * <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>-&gt;ActualSpeed;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;system begin&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">  <span class="function">PID <span class="title">pid</span><span class="params">(<span class="number">0.2</span>, <span class="number">0.15</span>, <span class="number">0.2</span>)</span></span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) </span><br><span class="line">  &#123;</span><br><span class="line">    std::cout &lt;&lt; pid.<span class="built_in">PID_realize</span>(<span class="number">200.0</span>) &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
